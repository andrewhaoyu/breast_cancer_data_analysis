)
###############generate the plot for H3K27ac
idx <- which(celltypes220_lua$mark=="H3K27ac")
celltype220_data1 <- celltype220_data[idx,]
# library(pheatmap)
# library(RColorBrewer)
# library(viridis)
paletteLength <- 50
my.color <- colorRampPalette(c("dodgerblue4", "white", "#c0392b"))(paletteLength)
myBreaks <- c(seq(min(celltype220_data1), 0, length.out=ceiling(paletteLength/2) + 1),
seq(max(celltype220_data1)/paletteLength, max(celltype220_data1), length.out=floor(paletteLength/2)))
pheatmap(
mat               = celltype220_data1,
color             = my.color,
breaks           = myBreaks,
cluster_rows=FALSE,
cluster_cols=FALSE,
# border_color      = NA,
# show_colnames     = FALSE,
# show_rownames     = FALSE,
# annotation_col    = mat_col,
# annotation_colors = mat_colors,
# drop_levels       = TRUE,
fontsize          = 12
# main              = "Default Heatmap"
)
png("H3K27_z.png", height = 32, width  = 28, units="cm",res = 300)
pheatmap(
mat               = celltype220_data1,
color             = my.color,
breaks           = myBreaks,
cluster_rows=FALSE,
cluster_cols=FALSE,
# border_color      = NA,
# show_colnames     = FALSE,
# show_rownames     = FALSE,
# annotation_col    = mat_col,
# annotation_colors = mat_colors,
# drop_levels       = TRUE,
fontsize          = 12
# main              = "Default Heatmap"
)
dev.off()
setwd('/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/discovery_SNP/enrichment_analysis/result/rediscoveryprojectnextsteps')
library(ggplot2)
library(reshape)
###########220 celltypes results
celltypes220_lua <- read.table("220celltype.1.lumA.txt",
header=T)
celltypes220_lua$log10p <- -log10(celltypes220_lua$Enrichment_p)
celltypes220_TN <- read.table("220celltype.2.TN.txt",header=T)
celltypes220_TN$log10p <- -log10(celltypes220_TN$Enrichment_p)
# subtypes <- c(rep("Luminal A like",nrow(celltypes220_lua)),
#               rep("Triple negative",nrow(celltypes220_lua)))
#################create a plot for enrichment score
n <- nrow(celltypes220_lua)
cell_type <- paste0(as.character(celltypes220_lua$cell_type), "_",
as.character(celltypes220_lua$mark))
cell_type[137] <- "Fetal_brain_(H3K4me3)_2"
cell_type[60] <- "Pancreatic_islets_H3K4me1_2"
cell_type[138] <- "Pancreatic_islets_H3K4me3_2"
luminal_enrichment_score <- celltypes220_lua$Coefficient_z.score
triple_neg_enrichment_score <- celltypes220_TN$Coefficient_z.score
celltype220_data <- data.frame(luminal_enrichment_score,
triple_neg_enrichment_score)
rownames(celltype220_data) <- cell_type
colnames(celltype220_data) <- c("Luminal A like",
"Triple negative")
celltype220_data <- as.matrix(celltype220_data)
#plot(celltype220_data[,1],celltype220_data[,2])
celltype220_data1 <- celltype220_data[c(55,56,57,58,133,134,135,181),]
library(pheatmap)
library(RColorBrewer)
library(viridis)
paletteLength <- 20
my.color <- colorRampPalette(c("dodgerblue4", "white", "#c0392b"))(paletteLength)
myBreaks <- c(seq(min(celltype220_data1), 0, length.out=ceiling(paletteLength/2) + 1),
seq(max(celltype220_data1)/paletteLength, max(celltype220_data1), length.out=floor(paletteLength/2)))
png("brest_cell_z.png", height = 32, width  = 28,units="cm" ,res = 300)
pheatmap(
mat               = celltype220_data1,
color             = my.color,
breaks           = myBreaks,
cluster_rows=FALSE,
cluster_cols=FALSE,
# border_color      = NA,
# show_colnames     = FALSE,
# show_rownames     = FALSE,
# annotation_col    = mat_col,
# annotation_colors = mat_colors,
# drop_levels       = TRUE,
fontsize          = 14
# main              = "Default Heatmap"
)
dev.off()
###############generate the plot for H3K27ac
idx <- which(celltypes220_lua$mark=="H3K27ac")
celltype220_data1 <- celltype220_data[idx,]
# library(pheatmap)
# library(RColorBrewer)
# library(viridis)
paletteLength <- 50
my.color <- colorRampPalette(c("dodgerblue4", "white", "#c0392b"))(paletteLength)
myBreaks <- c(seq(min(celltype220_data1), 0, length.out=ceiling(paletteLength/2) + 1),
seq(max(celltype220_data1)/paletteLength, max(celltype220_data1), length.out=floor(paletteLength/2)))
png("H3K27_z.png", height = 32, width  = 28, units="cm",res = 300)
pheatmap(
mat               = celltype220_data1,
color             = my.color,
breaks           = myBreaks,
cluster_rows=FALSE,
cluster_cols=FALSE,
# border_color      = NA,
# show_colnames     = FALSE,
# show_rownames     = FALSE,
# annotation_col    = mat_col,
# annotation_colors = mat_colors,
# drop_levels       = TRUE,
fontsize          = 12
# main              = "Default Heatmap"
)
dev.off()
head(celltype220_data1)
dim(celltype220_data1)
pheatmap(
mat               = celltype220_data1,
color             = my.color,
breaks           = myBreaks,
cluster_rows=FALSE,
cluster_cols=FALSE,
# border_color      = NA,
# show_colnames     = FALSE,
# show_rownames     = FALSE,
# annotation_col    = mat_col,
# annotation_colors = mat_colors,
# drop_levels       = TRUE,
fontsize          = 12
# main              = "Default Heatmap"
)
png("H3K27_z.png", height = 32, width  = 28, units="cm",res = 300)
pheatmap(
mat               = celltype220_data1,
color             = my.color,
breaks           = myBreaks,
cluster_rows=FALSE,
cluster_cols=FALSE,
# border_color      = NA,
# show_colnames     = FALSE,
# show_rownames     = FALSE,
# annotation_col    = mat_col,
# annotation_colors = mat_colors,
# drop_levels       = TRUE,
fontsize          = 12
# main              = "Default Heatmap"
)
dev.off()
setwd('/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/discovery_SNP/enrichment_analysis/result/rediscoveryprojectnextsteps')
library(ggplot2)
library(reshape)
###########220 celltypes results
celltypes220_lua <- read.table("220celltype.1.lumA.txt",
header=T)
celltypes220_lua$log10p <- -log10(celltypes220_lua$Enrichment_p)
celltypes220_TN <- read.table("220celltype.2.TN.txt",header=T)
celltypes220_TN$log10p <- -log10(celltypes220_TN$Enrichment_p)
# subtypes <- c(rep("Luminal A like",nrow(celltypes220_lua)),
#               rep("Triple negative",nrow(celltypes220_lua)))
#################create a plot for enrichment score
n <- nrow(celltypes220_lua)
cell_type <- paste0(as.character(celltypes220_lua$cell_type), "_",
as.character(celltypes220_lua$mark))
cell_type[137] <- "Fetal_brain_(H3K4me3)_2"
cell_type[60] <- "Pancreatic_islets_H3K4me1_2"
cell_type[138] <- "Pancreatic_islets_H3K4me3_2"
luminal_enrichment_score <- celltypes220_lua$Coefficient_z.score
triple_neg_enrichment_score <- celltypes220_TN$Coefficient_z.score
celltype220_data <- data.frame(luminal_enrichment_score,
triple_neg_enrichment_score)
rownames(celltype220_data) <- cell_type
colnames(celltype220_data) <- c("Luminal A like",
"Triple negative")
celltype220_data <- as.matrix(celltype220_data)
#plot(celltype220_data[,1],celltype220_data[,2])
celltype220_data1 <- celltype220_data[c(55,56,57,58,133,134,135,181),]
library(pheatmap)
library(RColorBrewer)
library(viridis)
paletteLength <- 20
my.color <- colorRampPalette(c("dodgerblue4", "white", "#c0392b"))(paletteLength)
myBreaks <- c(seq(min(celltype220_data1), 0, length.out=ceiling(paletteLength/2) + 1),
seq(max(celltype220_data1)/paletteLength, max(celltype220_data1), length.out=floor(paletteLength/2)))
png("brest_cell_z.png", height = 32, width  = 28,units="cm" ,res = 300)
pheatmap(
mat               = celltype220_data1,
color             = my.color,
breaks           = myBreaks,
cluster_rows=FALSE,
cluster_cols=FALSE,
# border_color      = NA,
# show_colnames     = FALSE,
# show_rownames     = FALSE,
# annotation_col    = mat_col,
# annotation_colors = mat_colors,
# drop_levels       = TRUE,
fontsize          = 14
# main              = "Default Heatmap"
)
dev.off()
idx <- which(celltypes220_lua$mark=="H3K27ac")
celltype220_data2 <- celltype220_data[idx,]
# library(pheatmap)
# library(RColorBrewer)
# library(viridis)
paletteLength <- 50
my.color <- colorRampPalette(c("dodgerblue4", "white", "#c0392b"))(paletteLength)
myBreaks <- c(seq(min(celltype220_data2), 0, length.out=ceiling(paletteLength/2) + 1),
seq(max(celltype220_data2)/paletteLength, max(celltype220_data1), length.out=floor(paletteLength/2)))
png("H3K27_z.png", height = 32, width  = 28, units="cm",res = 300)
pheatmap(
mat               = celltype220_data2,
color             = my.color,
breaks           = myBreaks,
cluster_rows=FALSE,
cluster_cols=FALSE,
# border_color      = NA,
# show_colnames     = FALSE,
# show_rownames     = FALSE,
# annotation_col    = mat_col,
# annotation_colors = mat_colors,
# drop_levels       = TRUE,
fontsize          = 12
# main              = "Default Heatmap"
)
dev.off()
#############baseline analysis
############################## create a data frame for gg plot2
baseline1.lua <- read.table("baseline.1.lumA.results.txt",header=T)
head(baseline1.lua)
baseline1.lua$Category
head(celltypes220_lua)
table(celltypes220_lua$mark)
setwd('/spin1/users/zhangh24/breast_cancer_data_analysis/')
median(N.lua)
median(N.TN)
?strsplit
?apply
?pnorm
?merge
?Reduce
head(case_control_meta_result_final)
colnames(case_control_meta_result_final)
24*5
?strsplit
setwd('/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/discovery_SNP/enrichment_analysis/result/rediscoveryprojectnextsteps')
library(ggplot2)
library(reshape)
TestDiff <- function(x1,s1,x2,s2){
z = (x1-x2)/sqrt(s1^2+s2^2)
return(2*pnorm(abs(z),lower.tail = F))
}
##########baseline results main
baseline_result <- read.csv("baseline_results_main.csv")
low.95 <- baseline_result$Enrichment - baseline_result$Enrichment_std_error
high.95 <- baseline_result$Enrichment + baseline_result$Enrichment_std_error
baseline_result$high.95 <- high.95
baseline_result$low.95 <- low.95
ggplot(data=baseline_result,aes(x=Annotation,y=Enrichment))+
geom_bar(stat = "identity",
position = "dodge",
aes(fill=Subtypes)
)+
theme_minimal()+  theme(axis.text.x = element_text(angle = 0, hjust = 1)) + ylab("Enrichment") +
#ggtitle("Enrichment analysis of 220 celltypes")  +
theme(text = element_text(size=10),plot.title = element_text(hjust = 0.5,face = "bold"),axis.text.x = element_text(face = "bold",hjust = 0.5,angle = 90),
axis.text.y = element_text(face = "bold.italic"),
axis.title.x = element_text(face = "bold"),
axis.title.y = element_text(face = "bold"))+
geom_hline(yintercept = 1, linetype="dashed", color = "blue")+
coord_flip()+
scale_y_continuous(breaks=c(-5,0,1,5,10,15,20))
ggplot(data=baseline_result,aes(x=Annotation,y=Enrichment))+
geom_bar(stat = "identity",
position = "dodge",
aes(fill=Subtypes)
)+
theme_minimal()+  theme(axis.text.x = element_text(angle = 0, hjust = 1)) + ylab("Enrichment") +
#ggtitle("Enrichment analysis of 220 celltypes")  +
theme(text = element_text(size=10),plot.title = element_text(hjust = 0.5,face = "bold"),axis.text.x = element_text(face = "bold",hjust = 0.5,angle = 90),
axis.text.y = element_text(face = "bold.italic"),
axis.title.x = element_text(face = "bold"),
axis.title.y = element_text(face = "bold"))+
geom_hline(yintercept = 1, linetype="dashed", color = "blue")+
coord_flip()+
scale_y_continuous(breaks=c(-5,0,1,5,10,15,20))+
geom_errorbar(aes(ymax = high.95,
ymin = low.95,
shape=Subtypes),
position= "dodge")+
scale_color_manual(values=c("black","black"))
png("baseline_main_results.png", height = 16, width  = 19.04, res = 300, units = "cm")
low.95 <- baseline_result$Enrichment - baseline_result$Enrichment_std_error
high.95 <- baseline_result$Enrichment + baseline_result$Enrichment_std_error
baseline_result$high.95 <- high.95
baseline_result$low.95 <- low.95
ggplot(data=baseline_result,aes(x=Annotation,y=Enrichment))+
geom_bar(stat = "identity",
position = "dodge",
aes(fill=Subtypes)
)+
theme_minimal()+  theme(axis.text.x = element_text(angle = 0, hjust = 1)) + ylab("Enrichment") +
#ggtitle("Enrichment analysis of 220 celltypes")  +
theme(text = element_text(size=10),plot.title = element_text(hjust = 0.5,face = "bold"),axis.text.x = element_text(face = "bold",hjust = 0.5,angle = 90),
axis.text.y = element_text(face = "bold.italic"),
axis.title.x = element_text(face = "bold"),
axis.title.y = element_text(face = "bold"))+
geom_hline(yintercept = 1, linetype="dashed", color = "blue")+
coord_flip()+
scale_y_continuous(breaks=c(-5,0,1,5,10,15,20))+
geom_errorbar(aes(ymax = high.95,
ymin = low.95,
shape=Subtypes),
position= "dodge")+
scale_color_manual(values=c("black","black"))
#facet_grid(.~subtypes)+
#  theme(strip.text = element_text(face = "bold"))
dev.off()
getwd()
##########baseline results main
baseline_result <- read.csv("baseline_results_main.csv")
png("baseline_main_results.png", height = 16, width  = 19.04, res = 300, units = "cm")
low.95 <- baseline_result$Enrichment - baseline_result$Enrichment_std_error
high.95 <- baseline_result$Enrichment + baseline_result$Enrichment_std_error
baseline_result$high.95 <- high.95
baseline_result$low.95 <- low.95
ggplot(data=baseline_result,aes(x=Annotation,y=Enrichment))+
geom_bar(stat = "identity",
position = "dodge",
aes(fill=Subtypes)
)+
theme_minimal()+  theme(axis.text.x = element_text(angle = 0, hjust = 1)) + ylab("Enrichment") +
#ggtitle("Enrichment analysis of 220 celltypes")  +
theme(text = element_text(size=10),plot.title = element_text(hjust = 0.5,face = "bold"),axis.text.x = element_text(face = "bold",hjust = 0.5,angle = 90),
axis.text.y = element_text(face = "bold.italic"),
axis.title.x = element_text(face = "bold"),
axis.title.y = element_text(face = "bold"))+
geom_hline(yintercept = 1, linetype="dashed", color = "blue")+
coord_flip()+
scale_y_continuous(breaks=c(-5,0,1,5,10,15,20))+
geom_errorbar(aes(ymax = high.95,
ymin = low.95,
shape=Subtypes),
position= "dodge")+
scale_color_manual(values=c("black","black"))
#facet_grid(.~subtypes)+
#  theme(strip.text = element_text(face = "bold"))
dev.off()
###########baseline results with 500kb extension
baseline_result <- read.csv("baseline_500kb.csv")
low.95 <- baseline_result$Enrichment - baseline_result$Enrichment_std_error
high.95 <- baseline_result$Enrichment + baseline_result$Enrichment_std_error
baseline_result$high.95 <- high.95
baseline_result$low.95 <- low.95
png("baseline_results_500bp.png",height = 16, width  = 19.04, res = 300, units = "cm" )
ggplot(data=baseline_result,aes(x=Annotation,y=Enrichment))+
geom_bar(stat = "identity",
position = "dodge",
aes(fill=Subtypes)
)+
theme_minimal()+  theme(axis.text.x = element_text(angle = 0, hjust = 1)) + ylab("Enrichment") +
#ggtitle("Enrichment analysis of 220 celltypes")  +
theme(text = element_text(size=10),plot.title = element_text(hjust = 0.5,face = "bold"),axis.text.x = element_text(face = "bold",hjust = 0.5,angle = 0),
axis.text.y = element_text(face = "bold.italic"),
axis.title.x = element_text(face = "bold"),
axis.title.y = element_text(face = "bold"))+
geom_hline(yintercept = 1, linetype="dashed", color = "blue")+
coord_flip()+
scale_y_continuous(breaks=c(-5,0,1,5,10,15,20))+
geom_errorbar(aes(ymax = high.95,
ymin = low.95,
shape=Subtypes),
position= "dodge")+
scale_color_manual(values=c("black","black"))
dev.off()
png("baseline_results_500bp_95.png",height = 16, width  = 19.04, res = 300, units = "cm" )
CI95withP <- function(effect,std){
z <- effect/std
p <- 2*pnorm(abs(z),lower.tail = F)
effect.low <- effect-1.96*std
effect.high <- effect+1.96*std
effect.result <- paste0(exp(effect),"(",
exp(effect.low),"-",
exp(effect.high),")")
return(list(p,effect.result))
}
CI95withP(-0.058051833,0.010427782)
CI95withP(0.037871486,0.006937093)
CI95withP(0.036125225,0.006019181)
CI95withP(-0.03461619,0.005972463)
CI95withP(-0.035276491,0.006437138)
CI95withP(-0.0364311677127345,0.006591356)
CI95withP(-0.033661296,0.006051469)
CI95withP(-0.036271808,0.006003492)
CI95withP(0.049434894,0.008805491)
CI95withP(-0.04166881,0.007184466)
CI95withP(-0.034121937,0.006185711)
CI95withP(0.044604636,0.007864454)
CI95withP(-0.035586367,0.006362602)
CI95withP(-0.033563129,0.006028237)
CI95withP(-0.03302271,0.006037485)
CI95withP(-0.074770785,0.010923939)
CI95withP(-0.036932069,0.006345693)
CI95withP(0.043701519,0.006908488)
CI95withP(-0.039522631,0.007208705)
CI95withP(0.037679715,0.006395676)
CI95withP(0.037679715,0.006395676)
CI95withP(0.04239498,0.007150285)
CI95withP(0.06653665,0.011429894)
snp1 <- discovery.snp.onco[idx.control,i.dis]
snp2 <- data2[idx.control,i.known]
p12 <- cov(snp1,snp2)+p1*p2
LDandDp <- function(snp1,snp2){
LD <- cor(snp1,snp2)^2
p1 <- sum(snp1)/(2*length(snp1))
p2 <- sum(snp2)/(2*length(snp2))
p12 <- cov(snp1,snp2)+p1*p2
d <- p12-p1*p2
if(p12<0){
dmax <- max(-p1*p2,-(1-p1)*(1-p2))
}else{
dmax <- min(p1*(1-p2),(1-p1)*p2)
}
Dp <- d/dmax
return(list(LD,Dp))
}
LDandDp <- function(snp1,snp2){
LD <- cor(snp1,snp2)^2
p1 <- mean(snp1)
p2 <- mean(snp2)
#p12 <- cov(snp1,snp2)+p1*p2
d <- cov(snp1,snp2)
if(d<0){
dmax <- min(p1*p2,(1-p1)*(1-p2))
}else{
dmax <- min(p1*(1-p2),(1-p1)*p2)
}
Dp <- d/dmax
return(list(LD,Dp))
}
i.dis <- which(colnames(discovery.snp.onco)=="1:145126177:G:A")
i.known <- which(colnames(data2)=="rs12405132")
idx.control <- which(data2$Behaviour1==0)
snp1 <- discovery.snp.onco[idx.control,i.dis]
snp2 <- as.vector(data2[idx.control,i.known])
LDandDp(snp1,snp2)
#######snp 1:145126177 and snp rs12405132
i.dis <- which(colnames(discovery.snp.onco)=="1:145126177:G:A")
extract.result.onco <- extract.result[[2]]
low.95 <- baseline_result$Enrichment - baseline_result$Enrichment_std_error
##########baseline results main
baseline_result <- read.csv("baseline_results_main.csv")
low.95 <- baseline_result$Enrichment - baseline_result$Enrichment_std_error
high.95 <- baseline_result$Enrichment + baseline_result$Enrichment_std_error
baseline_result$high.95 <- high.95
baseline_result$low.95 <- low.95
ggplot(data=baseline_result,aes(x=Annotation,y=Enrichment))+
geom_bar(stat = "identity",
position = "dodge",
aes(fill=Subtypes)
)+
theme_minimal()+  theme(axis.text.x = element_text(angle = 0, hjust = 1)) + ylab("Enrichment") +
#ggtitle("Enrichment analysis of 220 celltypes")  +
theme(text = element_text(size=10),plot.title = element_text(hjust = 0.5,face = "bold"),axis.text.x = element_text(face = "bold",hjust = 0.5,angle = 90),
axis.text.y = element_text(face = "bold.italic"),
axis.title.x = element_text(face = "bold"),
axis.title.y = element_text(face = "bold"))+
geom_hline(yintercept = 1, linetype="dashed", color = "blue")+
coord_flip()+
scale_y_continuous(breaks=c(-5,0,1,5,10,15,20))+
geom_errorbar(aes(ymax = high.95,
ymin = low.95,
shape=Subtypes),
position= "dodge")+
scale_color_manual(values=c("black","black"))
low.95 <- baseline_result$Enrichment - baseline_result$Enrichment_std_error
high.95 <- baseline_result$Enrichment + baseline_result$Enrichment_std_error
baseline_result$high.95 <- high.95
baseline_result$low.95 <- low.95
head(baseline_result)
dim(baseline_result)
3000/4
snp.name <- colnames(discovery.snp.icog)[i1]
1100+60-71.2
(1100+60-71.2)/2
(1100+60-71.2)/2+316.94-177
CI95withP <- function(effect,std){
z <- effect/std
p <- 2*pnorm(abs(z),lower.tail = F)
effect.low <- effect-1.96*std
effect.high <- effect+1.96*std
effect.result <- paste0(exp(effect),"(",
exp(effect.low),"-",
exp(effect.high),")")
return(list(p,effect.result))
}
CI95withP(0.035662706,0.006323822)
CI95withP(0.133169052,0.024140049)
-0.042938989
0.006703173
CI95withP(-0.042938989,0.006703173)
table(data1$ER_status1,data1$study)
6.92*2.92/3.79
24*5
