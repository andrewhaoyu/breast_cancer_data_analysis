theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,105))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle("Invidual heterogenity test for PR")
temp <- temp+1
}
}
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
for(k in 1:1){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,40))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))+
temp <- temp+1
}
}
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
for(k in 1:1){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,40))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
temp <- temp+1
}
}
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
data.temp = data[idx,-2,drop=F]
for(k in 3:3){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
temp <- temp+1
}
}
library(reshape2)
library(gridExtra)
grid.arrange(p[[1]],p[[2]],p[[3]],
p[[4]],p[[5]],p[[6]],
p[[7]],p[[8]],p[[9]],
nrow=3)
png(paste0("plot_individual_test_all_others.png"),
height = 8,width = 16,
units = "in", res = 300)
grid.arrange(p[[1]],p[[2]],p[[3]],
p[[4]],p[[5]],p[[6]],
p[[7]],p[[8]],p[[9]],
nrow=3)
dev.off()
library(ggplot2)
sizes <- c(25000,50000,100000)
Sample_size = rep(sizes,3)
n.sizes <- length(sizes)
Missing_rate = c(rep(0.17,3),
rep(0.3,3),
rep(0.5,3))
data = cbind(Sample_size,Missing_rate,data)
data[,1] = as.character(data[,1])
p <- list()
missing_rate_vec <- c(0.17,0.30,0.50)
temp = 1
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
data.temp = data[idx,-2,drop=F]
for(k in 2:2){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,105))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
temp <- temp+1
}
}
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
for(k in 1:1){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,40))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
temp <- temp+1
}
}
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
data.temp = data[idx,-2,drop=F]
for(k in 3:3){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
temp <- temp+1
}
}
grid.arrange(p[[1]],p[[2]],p[[3]],
p[[4]],p[[5]],p[[6]],
p[[7]],p[[8]],p[[9]],
nrow=3)
setwd('/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/simulation/power/result')
data <- read.csv("indi.simulation.result_others.csv")
data <- data[,-1]
colnames(data) <- c(paste0("FTOP with all the markers ", c("PR","HER2","grade")),
c(paste0("Polytomous model with only one marker ", c("PR","HER2","grade"))))
library(ggplot2)
sizes <- c(25000,50000,100000)
Sample_size = rep(sizes,3)
n.sizes <- length(sizes)
Missing_rate = c(rep(0.17,3),
rep(0.3,3),
rep(0.5,3))
data = cbind(Sample_size,Missing_rate,data)
data[,1] = as.character(data[,1])
p <- list()
missing_rate_vec <- c(0.17,0.30,0.50)
temp = 1
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
data.temp = data[idx,-2,drop=F]
for(k in 2:2){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,105))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
temp <- temp+1
}
}
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
for(k in 1:1){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,40))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
temp <- temp+1
}
}
for(i in 1:length(missing_rate_vec)){
missing_rate_temp = missing_rate_vec[i]
idx <- which(data$Missing_rate==missing_rate_temp)
data.temp = data[idx,-2,drop=F]
for(k in 3:3){
data.m = melt(data.temp[,c(1,k+1,k+4)],id="Sample_size")
p[[temp]] = ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="none")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
temp <- temp+1
}
}
grid.arrange(p[[1]],p[[2]],p[[3]],
p[[4]],p[[5]],p[[6]],
p[[7]],p[[8]],p[[9]],
nrow=3)
png(paste0("plot_individual_test_all_others.png"),
height = 8,width = 16,
units = "in", res = 300)
grid.arrange(p[[1]],p[[2]],p[[3]],
p[[4]],p[[5]],p[[6]],
p[[7]],p[[8]],p[[9]],
nrow=3)
dev.off()
ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="bottem")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="bottom")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
png(paste0("plot_individual_all_other_markers_lengend.pnh"),width=16,height=8,units="in",res = 300)
ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="bottom")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
dev.off()
head(data.m)
data.temp[,c(1,k+1,k+4)]
colnames(data.temp2) <- c("FTOP with all the markers","Polytomous model with only one marker")
data.temp2 <- data.temp[,c(1,k+1,k+4)]
colnames(data.temp2) <- c("FTOP with all the markers","Polytomous model with only one marker")
data.m = melt(data.temp2,id="Sample_size")
data.temp2 <- data.temp[,c(1,k+1,k+4)]
colnames(data.temp2)[c(2,3)] <- c("FTOP with all the markers","Polytomous model with only one marker")
data.m = melt(data.temp2,id="Sample_size")
ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="bottom")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="bottom")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
dev.off()
png(paste0("plot_individual_all_other_markers_lengend.png"),width=16,height=8,units="in",res = 300)
data.temp2 <- data.temp[,c(1,k+1,k+4)]
colnames(data.temp2)[c(2,3)] <- c("FTOP with all the markers","Polytomous model with only one marker")
data.m = melt(data.temp2,id="Sample_size")
ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=variable))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="bottom")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
dev.off()
data.m
png(paste0("plot_individual_all_other_markers_lengend.png"),width=16,height=8,units="in",res = 300)
data.temp2 <- data.temp[,c(1,k+1,k+4)]
colnames(data.temp2)[c(2,3)] <- c("FTOP with all the markers","Polytomous model with only one marker")
data.m = melt(data.temp2,id="Sample_size")
colnames(data.m)[2] <- "Method"
ggplot(data.m,aes(x=Sample_size,y=value*1000,fill=Method))+
geom_bar(stat="identity",position=position_dodge(),
alpha=0.8)+
scale_fill_Publication()+
theme_Publication()+
scale_x_discrete(name = "Sample size", limits=c("25000","50000",
"1e+05"))+
scale_y_continuous(name="Type I error *1000",limits=c(0,5))+
theme(legend.position="bottom")+
geom_hline(yintercept = 1,color = "red",
linetype = 2)+
ggtitle(paste0 ("Missing rate of ER = ",missing_rate_temp))
dev.off()
3000/596
3000/564
564*5
?strsplit
?pmin
pmin(0,NA,na.rm = T)
pmin(0,NA,na.rm = F)
prs.code <- rep("c",length(select.names))
prs.code <- data.frame(prs.code,stringsAsFactors=F)
temp <- 1
for(i in 1:n.pthres){
for(j in 1:length(select.names)){
prs.code.temp <- paste0("/data/zhangh24/plink --score /data/zhangh24/BCAC/prs_file/",select.names[j],"_prs_pvaluecut_",i,".file no-sum no-mean-imputation --dosage /data/zhangh24/BCAC/impute_onco_dosage/dosage_all noheader skip0=1 skip1=1 format=1 --fam /data/zhangh24/BCAC/impute_onco/onco_plink.fam --out /data/zhangh24/BCAC/prs_out/",select.names[j],"_prs_",i,"_out")
prs.code[temp,1] <- prs.code.temp
temp <- temp+1
}
}
#write out the command and submit use cluster
write.table(prs.code,file = paste0("/data/zhangh24/breast_cancer_data_analysis/risk_prediction/LD_clumping/code/caculate.prs.sh"),col.names = F,row.names = F,quote=F)
?table
?table
?table
prs <-  whole_genome_clump_new %>%
filter(p.min<=pthres[i]) %>%
select(SNP,reference_allele,select.names[j])
colnames(prs) <- c("SNP","effect_allele","beta")
?data.frame
100*22
?min
?join
library(dplyr)
?join
prs.la.temp <-   snpvalue.result[,1:n.snp]%*%prs_compare[1:n.snp,5]
?table
colnames(temp)[2] <- "score"
?data.frame
2397-267-1270
827-500
1270+267
?data.frame
?match
idx.match <- match(test.sample_new[,1],true_result[,1])
?quantile
?pchisq
#prepare the data for creating ideogram using Phenogram
setwd("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis")
data <- read.csv("./data/212_known_discovery_snp_paper_order.csv")
head(data)
cate <- rep(0,nrow(data))
cate[1:178] <- c("178 knwon variants")
cate[179:200] <- c("22 variants detected in overall analysis")
cate[201:208] <- c("8 variants detected in two-stage polytomous regression")
cate[209:210] <- c("2 variants detected in BCAC TN and CIMBA BRCA1 meta-analysis")
data <- data.frame(data,cate)
colnames(data)[4] <- "category"
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = =T,quote=F,row.names = F)
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
colnames(data) <- c("snp","chr","pos","phenotypes")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
colnames(data) <- c("snp","chrom","pos","phenotypes")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
colnames(data) <- c("snp","chrom","pos","phenotype")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
data
colnames(data)
cate[1:178] <- c("knwon_variants")
cate[179:200] <- c("overall_analysis_variants")
cate[201:208] <- c("two-stage_polytomous_regression_variants")
cate[209:210] <- c("BCAC_TN_and_CIMBA_BRCA1_meta-analysis_variants")
data <- data.frame(data,cate)
colnames(data) <- c("snp","chrom","pos","phenotype")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
setwd("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis")
data <- read.csv("./data/212_known_discovery_snp_paper_order.csv")
cate <- rep(0,nrow(data))
cate[1:178] <- c("a")
cate[179:200] <- c("b")
cate[201:208] <- c("c")
cate[209:210] <- c("d")
data <- data.frame(data,cate)
colnames(data) <- c("snp","chrom","pos","phenotype")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
colnames(data) <- c("snp","chr","pos","phenotype")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
temp <- read.table("/Users/zhangh24/Desktop/try_sample.txt",header=T)
head(temp)
head(data)
head(temp)
dim(temp)
temp[1:210,] <- data[1:210,]
data <- data.frame(data,cate,stringsAsFactors = F)
colnames(data) <- c("snp","chr","pos","phenotype")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
temp <- read.table("/Users/zhangh24/Desktop/try_sample.txt",header=T)
temp[1:210,] <- data[1:210,]
head(temp)
head(temp[,1])
temp <- read.table("/Users/zhangh24/Desktop/try_sample.txt",header=T,stringsAsFactors = F)
temp[1:210,] <- data[1:210,]
dim(data)
head(data)
#prepare the data for creating ideogram using Phenogram
setwd("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis")
data <- read.csv("./data/212_known_discovery_snp_paper_order.csv")
cate <- rep(0,nrow(data))
cate[1:178] <- c("a")
cate[179:200] <- c("b")
cate[201:208] <- c("c")
cate[209:210] <- c("d")
data <- data.frame(data,cate,stringsAsFactors = F)
colnames(data) <- c("snp","chr","pos","phenotype")
head(data)
temp <- read.table("/Users/zhangh24/Desktop/try_sample.txt",header=T,stringsAsFactors = F)
temp[1:210,] <- data[1:210,]
write.table(temp,file = paste0("/Users/zhangh24/Desktop/try_sample_new.txt"),col.names = T,quote=F,row.names = F)
head(temp)
setwd("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis")
data <- read.csv("./data/212_known_discovery_snp_paper_order.csv")
cate <- rep(0,nrow(data))
cate[1:178] <- c("a")
cate[179:200] <- c("b")
cate[201:208] <- c("c")
cate[209:210] <- c("d")
data <- data.frame(data,cate,stringsAsFactors = F)
colnames(data) <- c("snp","chr","pos","phenotype")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F)
temp <- read.table("/Users/zhangh24/Desktop/try_sample.txt",header=T,stringsAsFactors = F)
temp[1:210,2:3] <- data[1:210,2:3]
head(temp)
write.table(temp,file = paste0("/Users/zhangh24/Desktop/try_sample_new.txt"),col.names = T,quote=F,row.names = F)
head(temp)
tail(temp)
temp <- read.table("/Users/zhangh24/Desktop/try_sample.txt",header=T,stringsAsFactors = F)
temp[1:210,2] <- data[1:210,2]
write.table(temp,file = paste0("/Users/zhangh24/Desktop/try_sample_new.txt"),col.names = T,quote=F,row.names = F)
head(temp)
temp <- read.table("/Users/zhangh24/Desktop/try_sample.txt",header=T,stringsAsFactors = F)
#temp[1:210,2] <- data[1:210,2]
write.table(temp,file = paste0("/Users/zhangh24/Desktop/try_sample_new.txt"),col.names = T,quote=F,row.names = F)
#temp[1:210,2] <- data[1:210,2]
write.table(temp,file = paste0("/Users/zhangh24/Desktop/try_sample_new.txt"),col.names = T,quote=F,row.names = F,sep="\t")
cate[1:178] <- c("Known variants")
cate[179:200] <- c("a")
cate[201:208] <- c("b")
cate[209:210] <- c("c")
data <- data.frame(data,cate,stringsAsFactors = F)
colnames(data) <- c("snp","chr","pos","phenotype")
write.table(data,file = paste0("./discovery_SNP/ideogram_plot/result/ideogram_data.txt"),col.names = T,quote=F,row.names = F,sep = "\t")
head(data)
