axis.title.x = element_text(face="bold"),
axis.title.y = element_text(face="bold"))
)
load(paste0("./risk_factor/result/intrinsic_imp/intrinsic_imp_merge.Rdata"))
coef.1 <- result[[1]]
coef.1
coef.1 <- result[[1]]
covar.1 <- result[[2]]
#interested in first 17 variable
n.in <- 17
colnames(coef.1)[1:n.in] <- c("Intercept",
paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
#reorganize the covariance matrix to match coef data.frame
#columns are the variables
n.var <- ncol(coef.1)
#rows are the 5 intrinsic subtypes plus 9
n.sub <- 5
var.1 <- matrix(diag(covar.1),nrow=n.sub)
result <- GenerateP(coef.1,var.1)
p <- result[[1]]
low.95 <- result[[2]]
high.95 <- result[[3]]
coef.1.n <- coef.1[,2:n.in]
var.1.n <- var.1[,2:n.in]
p.n <- p[,2:n.in]
low.95.n <- low.95[,2:n.in]
high.95.n <- high.95[,2:n.in]
coef.l <- as.vector(t(coef.1.n))
var.l <- as.vector(t(var.1.n))
p.l <- as.vector(t(p.n))
low.95.l <- as.vector(t(low.95.n))
high.95.l <- as.vector(t(high.95.n))
variable.l <- rep(colnames(coef.1.n),n.sub)
subtypes.l <- c(rep("Luminal A-like",ncol(coef.1.n)),
rep("Luminal B,HER2-negative-like",ncol(coef.1.n)),
rep("Luminal B-like",ncol(coef.1.n)),
rep("HER2 enriched-like",ncol(coef.1.n)),
rep("TN",ncol(coef.1.n)),
rep("missing",ncol(coef.1.n)))
#create the variable category for colour
variable.cat <- substr(variable.l,1,nchar(variable.l)-1)
new.data <- data.frame(variable.l,subtypes.l,
coef.l,
var.l,
p.l,
low.95.l,
high.95.l,
exp(coef.l),
exp(low.95.l),
exp(high.95.l),
variable.cat,
stringsAsFactors = F)
colnames(new.data) <- c("variable",
"subtypes",
"coef",
"variance",
"p-value",
"low95.coef",
"high95.coef",
"OR",
"ORlow95",
"ORhigh95",
"variable_cat")
subtypes <- c("Luminal A-like","Luminal B,HER2-negative-like",
"Luminal B-like",
"HER2 enriched-like",
"TN")
new.data.c <- new.data
head(new.data.c)
head(new.data)
head(coef.l)
coef.1
dim(coef.1)
head(coef.1.n)
head(coef.l)
coef.l <- as.vector(t(coef.1.n))
var.l <- as.vector(t(var.1.n))
p.l <- as.vector(t(p.n))
low.95.l <- as.vector(t(low.95.n))
high.95.l <- as.vector(t(high.95.n))
variable.l <- rep(colnames(coef.1.n),n.sub)
subtypes.l <- c(rep("Luminal A-like",ncol(coef.1.n)),
rep("Luminal B,HER2-negative-like",ncol(coef.1.n)),
rep("Luminal B-like",ncol(coef.1.n)),
rep("HER2 enriched-like",ncol(coef.1.n)),
rep("TN",ncol(coef.1.n)),
rep("missing",ncol(coef.1.n)))
#create the variable category for colour
variable.cat <- substr(variable.l,1,nchar(variable.l)-1)
new.data <- data.frame(variable.l,subtypes.l,
coef.l,
var.l,
p.l,
low.95.l,
high.95.l,
exp(coef.l),
exp(low.95.l),
exp(high.95.l),
variable.cat,
stringsAsFactors = F)
length(variable.l)
n.sub
length(subtypes.l)
var.l
variable.l
subtypes.l <- c(rep("Luminal A-like",ncol(coef.1.n)),
rep("Luminal B,HER2-negative-like",ncol(coef.1.n)),
rep("Luminal B-like",ncol(coef.1.n)),
rep("HER2 enriched-like",ncol(coef.1.n)),
rep("TN",ncol(coef.1.n)))
#rep("missing",ncol(coef.1.n)))
#create the variable category for colour
variable.cat <- substr(variable.l,1,nchar(variable.l)-1)
new.data <- data.frame(variable.l,subtypes.l,
coef.l,
var.l,
p.l,
low.95.l,
high.95.l,
exp(coef.l),
exp(low.95.l),
exp(high.95.l),
variable.cat,
stringsAsFactors = F)
colnames(new.data) <- c("variable",
"subtypes",
"coef",
"variance",
"p-value",
"low95.coef",
"high95.coef",
"OR",
"ORlow95",
"ORhigh95",
"variable_cat")
subtypes <- c("Luminal A-like","Luminal B,HER2-negative-like",
"Luminal B-like",
"HER2 enriched-like",
"TN")
new.data.c <- new.data
subtype.temp = subtypes[i]
new.data.plot <- new.data.c %>% filter(subtypes==subtype.temp)
print(
ggplot(new.data.plot,aes(x=variable,y=OR,ymin=ORlow95,ymax=ORhigh95,colour=variable_cat))+
geom_pointrange()+
#scale_colour_manual(values=c("#386cb0","#fdb462"))+
#geom_line(yintercept=1,lty=2)+
coord_flip()+
theme_bw()+
geom_hline(yintercept=1,size=1,lty=2)+
theme(legend.position="none")+
ylab("Odds ratio")+
#scale_y_continuous(breaks=c(0,1,2.5,5,8))+
#xlab("SNP")+
# facet_grid(.~method)+
ggtitle(paste0("Forest plot for odds ratio of ",subtype.temp)
)+
theme(plot.title = element_text(hjust=0.5,face="bold"),
axis.text=element_text(face="bold"),
axis.title.x = element_text(face="bold"),
axis.title.y = element_text(face="bold"))
)
coef.1
sigma.temp <- result.temp[[2]][(n.sub+1):(n.sub+length(model[[3]])),
(n.sub+1):(n.sub+length(model[[3]]))]
result.temp <- RubinPool(coef.all,sigma.all,n.imp)
#goal summary the results from intrinsic multiple imputation
setwd('/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis')
load(paste0("./risk_factor/result/intrinsic_imp/intrinsic_imp_merge.Rdata"))
coef.1 <- result[[1]]
covar.1 <- result[[2]]
#interested in first 17 variable
n.in <- 17
colnames(coef.1)[1:n.in] <- c("Intercept",
paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
#reorganize the covariance matrix to match coef data.frame
#columns are the variables
n.var <- ncol(coef.1)
#rows are the 5 intrinsic subtypes plus 9
n.sub <- 5
var.1 <- matrix(diag(covar.1),nrow=n.sub)
result <- GenerateP(coef.1,var.1)
p <- result[[1]]
low.95 <- result[[2]]
high.95 <- result[[3]]
coef.1.n <- coef.1[,2:n.in]
var.1.n <- var.1[,2:n.in]
p.n <- p[,2:n.in]
low.95.n <- low.95[,2:n.in]
high.95.n <- high.95[,2:n.in]
coef.l <- as.vector(t(coef.1.n))
var.l <- as.vector(t(var.1.n))
p.l <- as.vector(t(p.n))
low.95.l <- as.vector(t(low.95.n))
high.95.l <- as.vector(t(high.95.n))
variable.l <- rep(colnames(coef.1.n),n.sub)
subtypes.l <- c(rep("Luminal A-like",ncol(coef.1.n)),
rep("Luminal B,HER2-negative-like",ncol(coef.1.n)),
rep("Luminal B-like",ncol(coef.1.n)),
rep("HER2 enriched-like",ncol(coef.1.n)),
rep("TN",ncol(coef.1.n)))
#rep("missing",ncol(coef.1.n)))
#create the variable category for colour
variable.cat <- substr(variable.l,1,nchar(variable.l)-1)
new.data <- data.frame(variable.l,subtypes.l,
coef.l,
var.l,
p.l,
low.95.l,
high.95.l,
exp(coef.l),
exp(low.95.l),
exp(high.95.l),
variable.cat,
stringsAsFactors = F)
colnames(new.data) <- c("variable",
"subtypes",
"coef",
"variance",
"p-value",
"low95.coef",
"high95.coef",
"OR",
"ORlow95",
"ORhigh95",
"variable_cat")
subtypes <- c("Luminal A-like","Luminal B,HER2-negative-like",
"Luminal B-like",
"HER2 enriched-like",
"TN")
new.data.c <- new.data
new.data.c
colnames(coef.1)[1:n.in] <- c("Intercept",
paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
coef.1
coef.1 <- result[[1]]
covar.1 <- result[[2]]
#interested in first 17 variable
n.in <- 17
colnames(coef.1)[1:n.in] <- c(paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
load(paste0("./risk_factor/result/intrinsic_imp/intrinsic_imp_merge.Rdata"))
coef.1 <- result[[1]]
colnames(coef.1)
load(paste0("./risk_factor/result/intrinsic_imp/intrinsic_imp_merge.Rdata"))
coef.1 <- result[[1]]
covar.1 <- result[[2]]
#interested in first 17 variable
n.in <- 17
colnames(coef.1)
lengthc(paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
lengthc(paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5))))
length(c(paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5))))
load(paste0("./risk_factor/result/poly_imp/poly_imp_merge.Rdata"))
coef.1 <- result[[1]]
coef.1
#interested in first 17 variable
n.in <- 16
colnames(coef.1)[1:n.in] <- c(paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
#reorganize the covariance matrix to match coef data.frame
#columns are the variables
n.var <- ncol(coef.1)
#rows are the 5 intrinsic subtypes plus 9
n.sub <- 5
var.1 <- matrix(diag(covar.1),nrow=n.sub)
result <- GenerateP(coef.1,var.1)
p <- result[[1]]
low.95 <- result[[2]]
high.95 <- result[[3]]
coef.1.n <- coef.1[,2:n.in]
var.1.n <- var.1[,2:n.in]
p.n <- p[,2:n.in]
low.95.n <- low.95[,2:n.in]
colnames(coef.1)[1:n.in] <- c(paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
#reorganize the covariance matrix to match coef data.frame
#columns are the variables
n.var <- ncol(coef.1)
#rows are the 5 intrinsic subtypes plus 9
n.sub <- 5
var.1 <- matrix(diag(covar.1),nrow=n.sub)
result <- GenerateP(coef.1,var.1)
p <- result[[1]]
low.95 <- result[[2]]
high.95 <- result[[3]]
coef.1 <- result[[1]]
covar.1 <- result[[2]]
#interested in first 17 variable
n.in <- 16
colnames(coef.1)[1:n.in] <- c(paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
#reorganize the covariance matrix to match coef data.frame
#columns are the variables
n.var <- ncol(coef.1)
#rows are the 5 intrinsic subtypes plus 9
n.sub <- 5
var.1 <- matrix(diag(covar.1),nrow=n.sub)
result <- GenerateP(coef.1,var.1)
dim(var.1)
dim(coef.1)
dim(result[[2]])
length(coef.1)
#rows are the 5 intrinsic subtypes plus 9
n.sub <- 5
var.1 <- matrix(diag(covar.1),nrow=n.sub)
dim(var.1)
#goal summary the results from intrinsic multiple imputation
setwd('/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis')
load(paste0("./risk_factor/result/intrinsic_imp/intrinsic_imp_merge.Rdata"))
coef.1 <- result[[1]]
covar.1 <- result[[2]]
#interested in first 17 variable
n.in <- 16
colnames(coef.1)[1:n.in] <- c(paste0("agemenarche_cat",c(1,2,3)),
paste0("parity_cat",c(1,2,3,4)),
paste0("mensagelast_cat",c(1,2)),
paste0("agefftp_cat",c(2,3,4)),
paste0("breastmos_cat",c(2,3,4,5)))
#reorganize the covariance matrix to match coef data.frame
#columns are the variables
n.var <- ncol(coef.1)
#rows are the 5 intrinsic subtypes plus 9
n.sub <- 5
var.1 <- matrix(diag(covar.1),nrow=n.sub)
result <- GenerateP(coef.1,var.1)
p <- result[[1]]
low.95 <- result[[2]]
high.95 <- result[[3]]
coef.1.n <- coef.1[,2:n.in]
var.1.n <- var.1[,2:n.in]
p.n <- p[,2:n.in]
low.95.n <- low.95[,2:n.in]
coef.1.n <- coef.1[,1:n.in]
var.1.n <- var.1[,1:n.in]
p.n <- p[,1:n.in]
low.95.n <- low.95[,1:n.in]
high.95.n <- high.95[,1:n.in]
coef.l <- as.vector(t(coef.1.n))
var.l <- as.vector(t(var.1.n))
p.l <- as.vector(t(p.n))
low.95.l <- as.vector(t(low.95.n))
high.95.l <- as.vector(t(high.95.n))
variable.l <- rep(colnames(coef.1.n),n.sub)
subtypes.l <- c(rep("Luminal A-like",ncol(coef.1.n)),
rep("Luminal B,HER2-negative-like",ncol(coef.1.n)),
rep("Luminal B-like",ncol(coef.1.n)),
rep("HER2 enriched-like",ncol(coef.1.n)),
rep("TN",ncol(coef.1.n)))
#rep("missing",ncol(coef.1.n)))
#create the variable category for colour
variable.cat <- substr(variable.l,1,nchar(variable.l)-1)
new.data <- data.frame(variable.l,subtypes.l,
coef.l,
var.l,
p.l,
low.95.l,
high.95.l,
exp(coef.l),
exp(low.95.l),
exp(high.95.l),
variable.cat,
stringsAsFactors = F)
colnames(new.data) <- c("variable",
"subtypes",
"coef",
"variance",
"p-value",
"low95.coef",
"high95.coef",
"OR",
"ORlow95",
"ORhigh95",
"variable_cat")
subtypes <- c("Luminal A-like","Luminal B,HER2-negative-like",
"Luminal B-like",
"HER2 enriched-like",
"TN")
new.data.c <- new.data
write.csv(new.data.c,file = "./risk_factor/result/intrinsic_imp.csv")
subtype.temp = subtypes[i]
new.data.plot <- new.data.c %>% filter(subtypes==subtype.temp)
print(
ggplot(new.data.plot,aes(x=variable,y=OR,ymin=ORlow95,ymax=ORhigh95,colour=variable_cat))+
geom_pointrange()+
#scale_colour_manual(values=c("#386cb0","#fdb462"))+
#geom_line(yintercept=1,lty=2)+
coord_flip()+
theme_bw()+
geom_hline(yintercept=1,size=1,lty=2)+
theme(legend.position="none")+
ylab("Odds ratio")+
#scale_y_continuous(breaks=c(0,1,2.5,5,8))+
#xlab("SNP")+
# facet_grid(.~method)+
ggtitle(paste0("Forest plot for odds ratio of ",subtype.temp)
)+
theme(plot.title = element_text(hjust=0.5,face="bold"),
axis.text=element_text(face="bold"),
axis.title.x = element_text(face="bold"),
axis.title.y = element_text(face="bold"))
)
for(i in 1:length(subtypes)){
subtype.temp = subtypes[i]
png(paste0("./risk_factor/result/intrinsic_imp/intrinic_imp_result_",subtype.temp,".png"),height=20,width = 15,res=300,units="cm")
new.data.plot <- new.data.c %>% filter(subtypes==subtype.temp)
print(
ggplot(new.data.plot,aes(x=variable,y=OR,ymin=ORlow95,ymax=ORhigh95,colour=variable_cat))+
geom_pointrange()+
#scale_colour_manual(values=c("#386cb0","#fdb462"))+
#geom_line(yintercept=1,lty=2)+
coord_flip()+
theme_bw()+
geom_hline(yintercept=1,size=1,lty=2)+
theme(legend.position="none")+
ylab("Odds ratio")+
#scale_y_continuous(breaks=c(0,1,2.5,5,8))+
#xlab("SNP")+
# facet_grid(.~method)+
ggtitle(paste0("Forest plot for odds ratio of ",subtype.temp)
)+
theme(plot.title = element_text(hjust=0.5,face="bold"),
axis.text=element_text(face="bold"),
axis.title.x = element_text(face="bold"),
axis.title.y = element_text(face="bold"))
)
dev.off()
}
write.csv(new.data.c,file = "./risk_factor/result/intrinsic_imp.csv")
#data <- fread("./data/dataset_montse_20180522.txt")
setwd('/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis')
data <- fread("./data/Dataset_Montse_20190322.txt")
##reproduce Jenny's group polytomous model
############collapes breast mos cat 0,1
############collapes age fftp cat 0,1
##############we only focus on the invasive breast cancer cases
data$staus[data$status==2|data$status==3] <- 1
data$breastmos_cat[data$breastmos_cat==0] <- 1
data$agefftp_cat[data$agefftp_cat==0] <- 1
data$lastchildage_cat[data$lastchildage_cat==0] <- 1
library(dplyr)
data1 = data %>% filter(design_cat==0)
###############polytomous model
library(nnet)
######puting all of the missing data as NA for mice package to run
agemenarche_cat <- data1$agemenarche_cat
idx <- which(agemenarche_cat==9)
agemenarche_cat[idx] <- NA
parity_cat <- data1$parity_cat
idx <- which(parity_cat==9)
parity_cat[idx] <- NA
mensagelast_cat <- data1$mensagelast_cat
idx <- which(mensagelast_cat==9)
mensagelast_cat[idx] <- NA
agefftp_cat <- data1$agefftp_cat
idx <- which(agefftp_cat==9)
agefftp_cat[idx] <- NA
breastmos_cat <- data1$breastmos_cat
idx <- which(breastmos_cat==9)
breastmos_cat[idx] <- NA
lastchildage_cat <- data1$lastchildage_cat
idx <- which(lastchildage_cat==9)
lastchildage_cat[idx] <- NA
study <- data1$study
refage <- data1$refage
all.covariates <- data.frame(as.factor(agemenarche_cat),
as.factor(parity_cat),
as.factor(mensagelast_cat),
as.factor(agefftp_cat),
as.factor(breastmos_cat),
#as.factor(lastchildage_cat),
study,
refage)
head(data1$ER_status1)
library(mice)
md.pattern(all.covariates)
