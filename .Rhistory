B_r <- rep(0,n)
for(i in 1:(n-1)){
A_r[i] <- GenA_G_B(B_r[i])
B_r[i+1] <- GenB_G_A(A_r[i])
}
result <- cbind(A_r,B_r)
result <- result[n/2:(n-1),]
#hist(result)
table(result[,1],result[,2])/(nrow(result))
rbinom(1,1,1)
rbinom(1,1,0)
rbinom(10,1,0)
rbinom(10,1,0.1)
rbinom(100,1,0.1)
sum(rbinom(100,1,0.1))
head(result)
n <- 10000
A_r <- rep(0,n)
B_r <- rep(0,n)
for(i in 1:(n-1)){
A_r[i] <- GenA_G_B(B_r[i])
B_r[i+1] <- GenB_G_A(A_r[i])
}
result <- cbind(A_r,B_r)
result <- result[n/2:(n-1),]
#hist(result)
table(result[,1],result[,2])/(nrow(result))
GenA_G_B <- function(B){
p1= 0.8
p2 = 0.4
if(B==0){
A = rbinom(1,1,p1)
}else if(B==1){
A = rbinom(1,1,p2)
}
return(A)
}
GenB_G_A <- function(A){
p1= 3/4
p2 = 1/3
if(A==0){
B = rbinom(1,1,p1)
}else if(A==1){
B = rbinom(1,1,p2)
}
return(B)
}
n <- 10000
A_r <- rep(0,n)
B_r <- rep(0,n)
for(i in 1:(n-1)){
A_r[i] <- GenA_G_B(B_r[i])
B_r[i+1] <- GenB_G_A(A_r[i])
}
result <- cbind(A_r,B_r)
result <- result[n/2:(n-1),]
#hist(result)
table(result[,1],result[,2])/(nrow(result))
n <- 20000
A_r <- rep(0,n)
B_r <- rep(0,n)
for(i in 1:(n-1)){
A_r[i] <- GenA_G_B(B_r[i])
B_r[i+1] <- GenB_G_A(A_r[i])
}
result <- cbind(A_r,B_r)
result <- result[n/2:(n-1),]
#hist(result)
table(result[,1],result[,2])/(nrow(result))
dim(result)
result <- cbind(A_r,B_r)
result <- result[n/2:(n-1),]
dim(result)
result <- result[(n/2):(n-1),]
result <- cbind(A_r,B_r)
result <- result[(n/2):(n-1),]
dim(result)
#hist(result)
table(result[,1],result[,2])/(nrow(result))
n <- 10000
A_r <- rep(0,n)
B_r <- rep(0,n)
for(i in 1:(n-1)){
A_r[i] <- GenA_G_B(B_r[i])
B_r[i+1] <- GenB_G_A(A_r[i])
}
result <- cbind(A_r,B_r)
result <- result[(n/2):(n-1),]
#hist(result)
table(result[,1],result[,2])/(nrow(result))
n <- 10000
A_r <- rep(0,n)
B_r <- rep(0,n)
for(i in 1:(n-1)){
A_r[i] <- GenA_G_B(B_r[i])
B_r[i+1] <- GenB_G_A(A_r[i])
}
result <- cbind(A_r,B_r)
result <- result[(n/2):(n-1),]
#hist(result)
table(result[,1],result[,2])/(nrow(result))
n <- 1000
A_r <- rep(0,n)
B_r <- rep(0,n)
for(i in 1:(n-1)){
A_r[i] <- GenA_G_B(B_r[i])
B_r[i+1] <- GenB_G_A(A_r[i])
}
result <- cbind(A_r,B_r)
result <- result[(n/2):(n-1),]
#hist(result)
table(result[,1],result[,2])/(nrow(result))
n <- 10000
A_r <- rep(0,n)
B_r <- rep(0,n)
for(i in 1:(n-1)){
A_r[i] <- GenA_G_B(B_r[i])
B_r[i+1] <- GenB_G_A(A_r[i])
}
result <- cbind(A_r,B_r)
result <- result[(n/2):(n-1),]
#hist(result)
table(result[,1],result[,2])/(nrow(result))
8*7+8*5
162-96
168-96
x=rep(0,100,1,100,2,100)
y = c(rnorm(0,100),rnorm(1,100),rnorm(2,100))
plot(x,y)
x=rep(0,100,1,100,2,100)
y = c(rnorm(100,0),rnorm(100,1),rnorm(100,2))
plot(x,y)
x=c(rep(0,100),rep(1,100),rep(2,100))
y = c(rnorm(100,0),rnorm(100,1),rnorm(100,2))
plot(x,y)
n <- 200
x=c(rep(0,n),rep(1,n),rep(2,n))
y = c(rnorm(n,0),rnorm(n,1),rnorm(n,2))
plot(x,y)
(1100+60-182)/2
a=1
b=1
x = seq(-1,1,0.01)
y = a/(x^3+2*x^2-1)+b/(x^3+x-2)
plot(x,y)
a=1
b=2
x = seq(-1,1,0.01)
y = a/(x^3+2*x^2-1)+b/(x^3+x-2)
plot(x,y)
a=1
b=3
x = seq(-1,1,0.01)
y = a/(x^3+2*x^2-1)+b/(x^3+x-2)
plot(x,y)
a=2
b=3
x = seq(-1,1,0.01)
y = a/(x^3+2*x^2-1)+b/(x^3+x-2)
plot(x,y)
0.5/3
load("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/whole_genome_age/ICOG/Intrinsic_subtypes/result/intrinsic_subtype_triple_negative_results.Rdata")
load("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/whole_genome_age/ICOG/Intrinsic_subtypes/result/intrinsic_subtype_triple_negative_results.Rdata")
ls()
load("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/ICOG/icog_result_odds_sd.Rdata")
ls()
head(icog_result)
head(intrinsic_subtype_triple_negative_results)
library(dplry)
library(dplyr)
new_result <- merge(icog_result,intrinsic_subtype_triple_negative_results,by = "rs_id")
head(new_result)
dim(new_reuslt)
dim(new_result)
dim(icog_result)
dim(intrinsic_subtype_triple_negative_results)
head(new_result)
icog_result <- new_result %>% select(rs_id,CHR,position.x,allele1,allele2,logodds,sd,imputation_quality,freq_a1)
head(icog_resut)
head(icog_result)
2*pnorm(-abs(-1))
2*pnorm(-abs(-1.96))
icog_result <- new_result %>% select(rs_id,CHR,position.x,allele1,allele2,logodds,sd,imputation_quality,freq_a1) %>%
mutate(or = exp(logodds)) %>%
mutate(p =  2*pnorm(-abs(logodds/sd)))
head(icog_result)
min(icog_result$position.x)
min(icog_result$p)
icog_result <- new_result  %>%
mutate(or = exp(logodds)) %>%
mutate(p =  2*pnorm(-abs(logodds/sd)))%>%
mutate(ngt=0) %>%
select(rs_id,CHR,position.x,allele1,allele2,logodds,sd,imputation_quality,ngt,freq_a1)
colnames(icog_result) <- c("snpid",
"CHR",
"bp",
"a1",
"a2",
"or",
"se",
"pval",
"info",
"ngt",
"af")
head(icog_result)
icog_result <- new_result  %>%
mutate(or = exp(logodds)) %>%
mutate(p =  2*pnorm(-abs(logodds/sd)))%>%
mutate(ngt=0) %>%
select(rs_id,CHR,position.x,allele1,allele2,or,sd,imputation_quality,ngt,freq_a1)
head(icog_rseult)
head(icog_result)
icog_result <- new_result  %>%
mutate(or = exp(logodds)) %>%
mutate(p =  2*pnorm(-abs(logodds/sd)))%>%
mutate(ngt=0) %>%
select(rs_id,CHR,position.x,allele1,allele2,or,sd,p,imputation_quality,ngt,freq_a1)
colnames(icog_result) <- c("snpid",
"CHR",
"bp",
"a1",
"a2",
"or",
"se",
"pval",
"info",
"ngt",
"freq")
head(icog_result)
write.table(icog_result,file = "/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/ICOG/icog_result_standard_analysis.txt",col.names = T,quote = F)
head(icog_result)
tail(new_result)
load("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/discovery_SNP/enrichment_analysis/result/enrichment_analysis_data.Rdata")
head(enrichment_analysis_data)
library(readr)
KG <- fread("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/data/KG.all.chr.bim")
library(data.table)
KG <- fread("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/data/KG.all.chr.bim")
head(KG)
tail(KD)
tail(KG)
KG %>% mutate(CHRpos = paste0(V1,":",V4))
head(KG)
KG <- KG %>% mutate(CHRpos = paste0(V1,":",V4))
head(KG)
head(new_result)
head(icog_result)
icog_result <- mutate(CHRpos=paste0(CHR,":",bp))
icog_result <- icog_result %>% mutate(CHRpos=paste0(CHR,":",bp))
head(icog_result)
new_result <- merge(icog_result,KG,by = "CHRpos")
head(new_result)
icog_result <- %>% new_result %>% select(V2,CHR,position.x,allele1,allele2,or,sd,p,imputation_quality,ngt,freq_a1)
icog_result <-new_result %>% select(V2,CHR,position.x,allele1,allele2,or,sd,p,imputation_quality,ngt,freq_a1)
icog_result <- new_result %>% select(V2,CHR,bp,a1,a2,or,sd,p,imputation_quality,ngt,freq_a1)
icog_result <- new_result %>% select(V2,CHR,bp,a1,a2,or,sd,pval,imputation_quality,ngt,freq_a1)
icog_result <- new_result %>% select(V2,CHR,bp,a1,a2,or,sd,pval,info,ngt,freq_a1)
icog_result <- new_result %>% select(V2,CHR,bp,a1,a2,or,sd,pval,info,ngt,freq)
icog_result <- new_result %>% select(V2,CHR,bp,a1,a2,or,se,pval,info,ngt,freq)
colnames(icog_result) <- c("snpid",
"CHR",
"bp",
"a1",
"a2",
"or",
"se",
"pval",
"info",
"ngt",
"freq")
write.table(icog_result,file = "/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/ICOG/icog_result_standard_analysis.txt",col.names = T,quote = F)
dim(icog_result)
load("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/ONCO/onco_result_odds_sd.Rdata")
head(onco_reuslt)
head(onco_result)
#onco_result <- onco_result %>% mutate(CHRpos=paste0(CHR,":",bp))
new_result <- merge(onco_result,intrinsic_subtype_triple_negative_results,by="rs_id")
onco_result <- new_result  %>%
mutate(or = exp(logodds)) %>%
mutate(p =  2*pnorm(-abs(logodds/sd)))%>%
mutate(ngt=0) %>%
select(rs_id,CHR,position.x,allele1,allele2,or,sd,p,imputation_quality,ngt,freq_a1)
colnames(onco_result) <- c("snpid",
"CHR",
"bp",
"a1",
"a2",
"or",
"se",
"pval",
"info",
"ngt",
"freq")
new_result <- merge(onco_result,KG,by = "CHRpos")
head(KG)
head(onco_result)
head(new_result)
onco_result <- onco_result %>% mutate(CHRpos=paste0(CHR,":",bp))
new_result <- merge(onco_result,KG,by = "CHRpos")
onco_result <- new_result %>% select(V2,CHR,bp,a1,a2,or,se,pval,info,ngt,freq)
colnames(onco_result) <- c("snpid",
"CHR",
"bp",
"a1",
"a2",
"or",
"se",
"pval",
"info",
"ngt",
"freq")
write.table(onco_result,file = "/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/ONCO/onco_result_standard_analysis.txt",col.names=F,quote=F)
write.table(onco_result,file = "/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/ONCO/onco_result_standard_analysis.txt",col.names=T,quote=F)
write.table(onco_result,file = "/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/ONCO/onco_result_standard_analysis.txt",col.names=T,quote=F)
#load the meta-analysis results
load("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/meta/case_control_meta_result_final.Rdata")
head(case_control_meta_result_final)
meta_result <- case_control_meta_result_final
new_result <- merge(meta_result,intrinsic_subtype_triple_negative_results,by="rs_id")
meta_result <- new_result  %>%
mutate(or = exp(logodds)) %>%
mutate(p =  2*pnorm(-abs(logodds/sd)))%>%
mutate(ngt=0) %>%
select(rs_id,CHR,position.x,allele1,allele2,or,sd,p,imputation_quality,ngt,freq_a1)
head(new_result)
meta_result <- new_result  %>%
mutate(or = exp(logodds_meta)) %>%
mutate(p =  2*pnorm(-abs(logodds_meta/sd_meta)))%>%
mutate(ngt=0) %>%
select(rs_id,CHR,position.x,allele1,allele2,or,sd,p,imputation_quality,ngt,freq_a1)
meta_result <- new_result  %>%
mutate(or = exp(logodds_meta)) %>%
mutate(p =  2*pnorm(-abs(logodds_meta/sd_meta)))%>%
mutate(ngt=0) %>%
select(rs_id,CHR.x,position.x,allele1,allele2,or,sd,p,imputation_quality,ngt,freq_a1)
meta_result <- new_result  %>%
mutate(or = exp(logodds_meta)) %>%
mutate(p =  2*pnorm(-abs(logodds_meta/sd_meta)))%>%
mutate(ngt=0) %>%
select(rs_id,CHR.x,position.x,allele1,allele2,or,sd_meta,p,imputation_quality,ngt,freq_a1)
colnames(onco_result) <- c("snpid",
"CHR",
"bp",
"a1",
"a2",
"or",
"se",
"pval",
"info",
"ngt",
"freq")
meta_result <- meta_result %>% mutate(CHRpos=paste0(CHR,":",bp))
head(meta_result)
colnames(meta_result) <- c("snpid",
"CHR",
"bp",
"a1",
"a2",
"or",
"se",
"pval",
"info",
"ngt",
"freq")
meta_result <- meta_result %>% mutate(CHRpos=paste0(CHR,":",bp))
new_result <- merge(meta_result,KG,by = "CHRpos")
meta_result <- new_result %>% select(V2,CHR,bp,a1,a2,or,se,pval,info,ngt,freq)
colnames(meta_result) <- c("snpid",
"CHR",
"bp",
"a1",
"a2",
"or",
"se",
"pval",
"info",
"ngt",
"freq")
write.table(meta_result,file = "/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/genetic_correlation/standard_analysis/result/standard_gwas_result/case_control/meta/meta_result_standard_analysis.txt",col.names=T,quote=F)
34783+71788
37628+58134
106571*95762/(95762+106571)
head(onco_result)
onco_result[1:100,]
onco_result[101:200,]
onco_result[201:300,]
onco_result[301:400,]
onco_result[401:500,]
onco_result[501:600,]
onco_result[10501:10600,]
dim(onco_result)
head(onco_result)
idx <- which(is.na(onco_result$or))
head(idx)
dim(onco_result)
dim(meta_result)
dim(icog_result)
head(meta_result)
idx <- which(is.na(meta_result$or))
head(idx)
meta_result[idx[1:10],]
idx <- which(is.na(icog_result))
idx <- which(is.na(icog_result$or))
idx <- which(is.na(onco_result$or))
idx <- which(icog_result$snpid=="rs12069019")
icog_result[idx,]
idx <- which(onco_result$snpid=="rs12069019")
meta_result <- fread("/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/data/oncoarray_bcac_public_release_oct17.txt",header=T)
head(/Users/zhangh24/GoogleDrive/breast_cancer_data_analysis/data/oncoarray_bcac_public_release_oct17.t)
head(meta_result)
head(icog_result)
meta_result <- meta_result %>%
mutate(chrpos=paste0(chr,":",position_b37))
head(meta_result)
46785*42892/(46785+42892)
61282*45494/(45494+61282)
14910*17588/(17588+14910)
22377+26110.39+8069.33
46785+61282+14910
42892+45494+17588
122977*105974/(12297+105974)
122977*105974/(122977+105974)
?left_join
fine_map_new
0.014/(2*log(2))
0.323/(2*log(2))
0.533/(2*log(2))
2*log(2)
0.01727073/(2*log(2))
SigmaEst
2*log(2)*0.41
#setwd('/spin1/users/zhangh24/breast_cancer_data_analysis/')
load(paste0("./discovery_SNP/sensitivity_analysis/result/sensitivity_result.Rdata"))
library(data.table)
data1 <- fread("./data/iCOGS_euro_v10_10232017.csv",header=T)
data2 <- fread("./data/Onco_euro_v10_10232017.csv",header=T)
all.countries <- unique(c(data1$StudyCountry,data2$StudyCountry))
level1 <- levels(as.factor(all.countries))
n.coun <- 20
all.countries[n.coun+1] <- "Summary"
discover.casecase <- read.csv("./data/discovery_snp_casecase.csv",header = T)
discover.casecase
new.order <- c(9,13,5,17,4,18,
14,3,19)
discover.casecase <- discover.casecase[,]
library(forestplot)
plot.list <- list()
install.packages("forestplot")
library(forestplot)
plot.list <- list()
for(i1 in 1:length(new.order)){
print(i1)
data <- sensitivity.result[[new.order[i1]]]
data <- rbind(data,discover.casecase[new.order[i1],2:ncol(discover.casecase)])
all.countries <- factor(all.countries,levels=rev(c(level1,"Summary")))
levels(all.countries)
p <- c(1,4,7,10)
odds = as.vector(as.matrix(data[,p]))
low = c(as.matrix(data[,p+1]))
high <- c(as.matrix(data[,p+2]))
tumor <- c(rep("ER",n.coun+1),rep("PR",n.coun+1),
rep("HER2",n.coun+1),rep("Grade",n.coun+1))
tumor <- factor(tumor,levels = c("ER","PR","HER2","Grade"))
Type <- c(rep("ind",n.coun),"sum")
Type <- rep(Type,4)
#Size <- c(rep(1,n.coun),1)
new.data <- data.frame(odds,
low,
high,
Type,
label = all.countries,
tumor)
library(ggplot2)
fp <- ggplot(new.data,aes(x=label,y=odds,ymin=low,ymax=high,shape=Type,colour=Type))+
geom_pointrange()+
scale_colour_manual(values=c("#386cb0","#fdb462"))+
#geom_line(yintercept=1,lty=2)+
coord_flip()+
theme_bw()+
geom_hline(yintercept=1,size=1,lty=2)+
theme(legend.position="none")+
ylab("Odds Ratio (95% CI)")+
#scale_y_continuous(limits=c(0.90,1.1))+
xlab("Removed Countries")+
facet_grid(.~tumor)+
ggtitle(paste0("Forest plot of ", discover.casecase[new.order[i1],1])
)+
theme(plot.title = element_text(hjust=0.5))
plot.list[[i1]] <- fp
}
i1 = 3
plot.list[[i1]]
library(gridExtra)
width = 36
height = 25
png("./discovery_SNP/sensitivity_analysis/result/sensitivity_plot1.png",width=width,
height= height, units="cm", res= 600)
grid.arrange(plot.list[[1]],plot.list[[2]],plot.list[[3]],plot.list[[4]],plot.list[[5]],plot.list[[6]],nrow=3,ncol=2)
dev.off()
png("./discovery_SNP/sensitivity_analysis/result/sensitivity_plot2.png",width=width,
height= height, units="cm", res= 600)
grid.arrange(plot.list[[7]],plot.list[[8]],nrow=2,ncol=2)
dev.off()
png("./discovery_SNP/sensitivity_analysis/result/sensitivity_plot2.png",width=width,
height= height, units="cm", res= 600)
grid.arrange(plot.list[[7]],plot.list[[8]],plot.list[[8]],nrow=2,ncol=2)
dev.off()
length(new.order)
png("./discovery_SNP/sensitivity_analysis/result/sensitivity_plot2.png",width=width,
height= height, units="cm", res= 600)
grid.arrange(plot.list[[7]],plot.list[[8]],plot.list[[9]],nrow=2,ncol=2)
dev.off()
